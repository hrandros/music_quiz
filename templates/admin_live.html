{% extends "base.html" %}
{% block title %}LIVE • Rock Quiz{% endblock %}
{% block nav %}
<div class="container">
    <a class="navbar-brand fw-bold text-white" href="{{ url_for('index') }}" style="font-family: 'Oswald'; font-size: 1.5rem; letter-spacing: 1px;">
        <i class="bi bi-lightning-charge-fill text-danger me-1"></i> ROCK<span class="text-danger">QUIZ</span>
    </a>
    
    <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navContent" class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto gap-2 text-uppercase fw-bold" style="font-family: 'Oswald';">
            <li class="nav-item ms-lg-3">
                <a class="btn btn-sm btn-outline-light rounded-0 px-3" href="{{ url_for('admin_setup') }}" target="_blank">
                    <i class="bi bi-tools me-1"></i> Setup
                </a>
            </li>
            <li class="nav-item">
                <a class="btn btn-sm btn-danger rounded-0 px-3" href="{{ url_for('screen') }}" target="_blank">
                    <i class="bi bi-tv me-1"></i> TV Screen
                </a>
            </li>
        </ul>
    </div>
</div>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="text-white">LIVE <span class="text-danger">●</span></h2>
    <div>
        <button class="btn btn-outline-danger me-2" id="btn-autoplay" onclick="toggleAutoplay()">
            <i class="bi bi-collection-play"></i> AUTOPLAY
        </button>
        <button class="btn btn-warning" onclick="startTimer()">
            <i class="bi bi-stopwatch"></i> TIMER (30s)
        </button>
        <button class="btn btn-info" onclick="socket.emit('admin_show_results', {round: currentRound})">Prikaži Odgovore na TV</button>
        <button class="btn btn-info ms-2" onclick="LIVE.openGrading()">
            <i class="bi bi-list-check"></i> OCJENI
        </button>
    </div>
</div>

<div class="row">
    
    <div class="col-md-9">
        
        <div class="d-flex gap-2 mb-3">
            {% for i in range(1, 6) %}
            <button class="btn btn-outline-light round-tab" onclick="selectRound('{{i}}')">Runda {{i}}</button>
            {% endfor %}
        </div>

        <div id="grading-view" class="card border-info shadow mb-3" style="display:none;">
            <div class="card-header bg-info text-dark d-flex justify-content-between align-items-center">
                <h5 class="mb-0 fw-bold"><i class="bi bi-pencil-square me-2"></i>OCJENJIVANJE - RUNDA <span id="gradingRoundNum">1</span></h5>
                <div>
                    <button class="btn btn-dark btn-sm me-2" onclick="LIVE.closeGrading()">NATRAG</button>
                    <button class="btn btn-success btn-sm fw-bold" onclick="LIVE.finalizeRound()">POTVRDI REZULTATE <i class="bi bi-check-lg"></i></button>
                </div>
            </div>
            <div class="card-body bg-dark p-0">
                <div class="table-responsive" style="max-height: 600px;">
                    <table class="table table-dark table-hover table-bordered mb-0 align-middle text-center small">
                        <thead class="table-secondary text-dark sticky-top">
                            <tr>
                                <th style="width:5%">#</th>
                                <th style="width:15%">TIM</th>
                                <th style="width:40%">IZVOĐAČ <span class="text-muted">(Odgovor / Točno)</span></th>
                                <th style="width:40%">NAZIV <span class="text-muted">(Odgovor / Točno)</span></th>
                            </tr>
                        </thead>
                        <tbody id="gradingBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="card" id="playlist-card">
            <div class="card-body p-0 bg-dark" style="height:60vh; overflow:auto;">
                <table class="table table-dark table-hover mb-0">
                   <tbody id="songsTable">
                        {% for s in songs %}
                        <tr class="song-row" id="row-{{s.id}}" 
                            data-round="{{ s.round_number }}" 
                            data-duration="{{ s.duration }}"
                            data-artist="{{ s.artist }}" 
                            data-title="{{ s.title }}"
                            data-id="{{ s.id }}"> <td>{{ loop.index }}</td>
                            <td>
                                {% if s.type == 'visual' %} <span class="badge bg-info">VISUAL</span>
                                {% elif s.type == 'lyrics' %} <span class="badge bg-warning text-dark">LYRICS</span>
                                {% else %} <span class="badge bg-secondary">AUDIO</span>
                                {% endif %}
                                
                                <span class="badge bg-dark border border-secondary text-muted ms-1">R{{ s.round_number }}</span>
                            </td>
                            <td>
                                <div class="fw-bold text-white">{{ s.artist }}</div>
                                <div class="small text-muted">{{ s.title }}</div>
                            </td>
                            <td class="text-end">
                                <button class="btn btn-sm btn-primary" onclick="playSong('{{s.id}}')">PLAY</button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card bg-dark border-secondary mb-3 sticky-top" style="top: 20px; z-index: 100;">
            <div class="card-header border-secondary d-flex justify-content-between align-items-center">
                <span class="text-white small fw-bold"><i class="bi bi-people-fill me-2"></i>IGRAČI UŽIVO</span>
                <span class="badge bg-secondary" id="playerCount">0</span>
            </div>
            <div class="card-body p-0" style="max-height: 70vh; overflow-y: auto;">
                <table class="table table-dark table-sm table-hover mb-0 align-middle small">
                    <tbody id="playerListBody">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

</div> <div id="dj-console" class="fixed-bottom bg-black border-top border-danger p-3" style="display:none; z-index: 1050;">
    <div class="row align-items-center">
        <div class="col-4 text-white">
            <div id="np-artist" class="fw-bold"></div>
            <div id="np-title" class="small text-danger"></div>
        </div>
        <div class="col-4 text-center">
             <button class="btn btn-lg btn-danger rounded-circle" onclick="stopMusic()"><i class="bi bi-stop-fill"></i></button>
        </div>
        <div class="col-4"><input type="range" class="form-range" id="vol" max="1" step="0.1" oninput="setVol(this.value)"></div>
    </div>
    <audio id="audioPlayer"></audio>
</div>

{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/admin_live.js') }}"></script>
{% endblock %}