{% extends "base.html" %}
{% block title %}LIVE • Rock Quiz{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2 class="text-white">LIVE <span class="text-danger">●</span></h2>
    <div>
        <button class="btn btn-outline-danger me-2" id="btn-autoplay" onclick="toggleAutoplay()">
            <i class="bi bi-collection-play"></i> AUTOPLAY
        </button>
        <button class="btn btn-warning" onclick="startTimer()">
            <i class="bi bi-stopwatch"></i> TIMER (30s)
        </button>
    </div>
</div>

<div class="d-flex gap-2 mb-3">
    {% for i in range(1, 6) %}
    <button class="btn btn-outline-light round-tab" onclick="selectRound({{i}})">Runda {{i}}</button>
    {% endfor %}
</div>

<div id="grading-view" style="display:none;" class="card border-success mb-4">
    <div class="card-header bg-success text-white">OCJENJIVANJE</div>
    <div class="card-body bg-black p-0">
        <table class="table table-dark table-sm mb-0 align-middle">
            <thead><tr><th>Igrač</th><th>Artist</th><th>Title</th></tr></thead>
            <tbody id="gradingBody"></tbody>
        </table>
    </div>
</div>

<div class="card" id="playlist-card">
    <div class="card-body p-0 bg-dark" style="height:60vh; overflow:auto;">
        <table class="table table-dark table-hover mb-0">
           <tbody id="songsTable">
                {% for s in songs %}
                <tr class="song-row" id="row-{{s.id}}" 
                    data-round="{{ s.round_number }}" 
                    data-duration="{{ s.duration }}"
                    data-artist="{{ s.artist }}" 
                    data-title="{{ s.title }}">
                    
                    <td>{{ loop.index }}</td>
                    <td>
                        {% if s.type == 'visual' %} <span class="badge bg-info">VISUAL</span>
                        {% elif s.type == 'lyrics' %} <span class="badge bg-warning text-dark">LYRICS</span>
                        {% else %} <span class="badge bg-secondary">AUDIO</span>
                        {% endif %}
                        
                        <span class="badge bg-dark border border-secondary text-muted ms-1">R{{ s.round_number }}</span>
                    </td>
                    <td>
                        <div class="fw-bold text-white">{{ s.artist }}</div>
                        <div class="small text-muted">{{ s.title }}</div>
                    </td>
                    <td class="text-end">
                        <button class="btn btn-sm btn-primary" onclick="playSong({{s.id}})">PLAY</button>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div id="dj-console" class="fixed-bottom bg-black border-top border-danger p-3" style="display:none;">
    <div class="row align-items-center">
        <div class="col-4 text-white">
            <div id="np-artist" class="fw-bold"></div>
            <div id="np-title" class="small text-danger"></div>
        </div>
        <div class="col-4 text-center">
             <button class="btn btn-lg btn-danger rounded-circle" onclick="stopMusic()"><i class="bi bi-stop-fill"></i></button>
        </div>
        <div class="col-4"><input type="range" class="form-range" id="vol" max="1" step="0.1" oninput="setVol(this.value)"></div>
    </div>
    <audio id="audioPlayer"></audio>
</div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/admin_live.js') }}"></script>
{% endblock %}