{% extends "base.html" %}
{% block title %}TV Screen{% endblock %}

{% block extra_head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
  nav, footer { display: none !important; }
  body { background-color: #000; overflow: hidden; height: 100vh; font-family: 'Roboto Condensed', sans-serif; }

  /* Leaderboard animacije */
  .lb-row {
    font-size: 1.8rem;
    padding: 12px 20px;
    border-bottom: 1px solid #333;
    font-family: 'Oswald', sans-serif;
    transition: all 0.5s ease;
  }
  .lb-row:first-child {
    background-color: #1a1a1a; color: #ffc107; font-size: 2.2rem; border-left: 8px solid #ffc107;
  }

  /* Vizualizator */
  .visualizer-container {
    display: flex; justify-content: center; align-items: flex-end;
    height: 120px; gap: 8px;
  }
  .bar {
    width: 15px; background: linear-gradient(to top, #dc3545, #ffc107);
    border-radius: 3px 3px 0 0;
    animation: equalize 0.8s ease-in-out infinite alternate;
    height: 10%;
  }
  @keyframes equalize {
    0% { height: 15%; }
    100% { height: 100%; box-shadow: 0 0 15px #dc3545; }
  }
  .paused .bar { animation-play-state: paused; height: 5% !important; opacity: 0.2; }

  /* Odgovor koji se pojavljuje nakon pjesme */
  #correct-answer-display {
    text-align: center;
    width: 100%;
    animation: zoomIn 0.5s;
  }
  
  /* Stil za QR kod bijelu podlogu */
  #qrcode img {
    margin: 0 auto;
  }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid h-100 p-0">
  <div class="row h-100 g-0">

    <div class="col-7 bg-black text-white position-relative border-end border-secondary d-flex flex-column justify-content-center align-items-center p-5">
  
      <div class="position-absolute top-0 start-0 p-4">
        <h1 class="fw-bold text-danger mb-0" style="font-family:'Oswald'; letter-spacing: 2px;">ROCK QUIZ</h1>
        <h3 class="text-secondary small">RUNDA <span id="roundDisplay">1</span></h3>
      </div>

      <div id="welcome-area" class="d-none text-center animate__animated animate__fadeIn">
          <h2 id="welcome-msg" class="text-white mb-4" style="font-family: 'Oswald';"></h2>
          
          <div class="d-inline-block p-3 bg-white rounded-4 shadow-lg mb-4">
              <div id="qrcode"></div>
          </div>
          
          <h3 class="text-warning fw-bold animate__animated animate__pulse animate__infinite" style="font-family: 'Oswald';">
              SKENIRAJ ZA PRIJAVU!
          </h3>
      </div>

      <div id="game-area" class="text-center w-100">
          <div id="visualizer" class="mb-5 visualizer-container paused">
              {% for i in range(10) %}<div class="bar"></div>{% endfor %}
          </div>

          <h1 id="songDisplay" class="display-1 fw-bold text-white mb-2" style="font-family: 'Oswald';">ČEKAM...</h1>
          <h3 id="statusLabel" class="text-muted text-uppercase tracking-widest">PRIPREMA</h3>

          <div id="correct-answer-display" class="d-none mt-4 animate__animated animate__fadeIn">
              <h4 class="text-danger mb-1">TOČAN ODGOVOR:</h4>
              <h2 id="ansKey" class="text-white fw-bold"></h2>
          </div>

          <div id="timerWrapper" class="d-none mt-5">
            <svg width="150" height="150" viewBox="0 0 120 120" class="mx-auto d-block">
                <circle cx="60" cy="60" r="54" fill="none" stroke="#333" stroke-width="8" />
                
                <circle id="timerRing" cx="60" cy="60" r="54" fill="none" stroke="#dc3545" stroke-width="8" 
                        stroke-dasharray="339.29" stroke-dashoffset="0" stroke-linecap="round" 
                        transform="rotate(-90 60 60)" 
                        style="transition: stroke-dashoffset 1s linear, stroke 0.3s ease;" />
                
                <text id="timerVal" x="60" y="72" text-anchor="middle" fill="white" 
                      font-size="35" font-weight="bold" style="font-family: 'Oswald'; shadow: 2px 2px 4px rgba(0,0,0,0.5);">
                    0
                </text>
            </svg>
            <p class="text-muted mt-2 small text-uppercase fw-bold" style="letter-spacing: 2px;">Preostalo vrijeme</p>
        </div>
      </div>

    </div>

    <div class="col-5 bg-dark border-start border-secondary shadow-lg">
      <div class="p-4 h-100 d-flex flex-column">
        <h2 class="text-white border-bottom border-secondary pb-3 mb-0 text-uppercase" style="font-family: 'Oswald'; letter-spacing: 2px;">
          <i class="bi bi-trophy-fill text-warning me-2"></i> POREDAK
        </h2>

        <div id="lbContent" class="flex-grow-1 overflow-hidden mt-2 animate__animated animate__fadeIn">
            </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/screen.js') }}"></script>
{% endblock %}