
{% extends "base.html" %}
{% block title %}Igrač • Rock Quiz{% endblock %}

{% block nav %}
<div class="container">
  <a class="navbar-brand fw-bold text-white" href="{{ url_for('public.index') }}"
     style="font-family: 'Oswald'; font-size: 1.5rem; letter-spacing: 1px;">
    <i class="bi bi-lightning-charge-fill text-danger me-1" aria-hidden="true"></i>
    ROCK<span class="text-danger">QUIZ</span>
  </a>
</div>
{% endblock %}

{% block content %}
<div class="container-sm" style="max-width:500px;">
  <!-- LOGIN SCREEN -->
  <div id="login-screen" class="fade-in">
    <h1 class="text-center text-white mb-4 display-2">
      <i class="bi bi-boombox d-block mb-2" aria-hidden="true"></i>
      <span class="sr-only">Rock Quiz Igrač</span>
      <small class="d-block fs-5 text-muted fw-normal mt-2">Pridruži se timu</small>
    </h1>

    <div class="mb-3">
      <label for="username" class="form-label text-white fw-bold mb-2">
        <i class="bi bi-people-fill me-2 text-info" aria-hidden="true"></i>
        Ime tima
      </label>
      <input type="text" id="username" class="form-control form-control-lg text-center"
             placeholder="npr. Rockeri XY"
             autocomplete="off"
             aria-describedby="usernameHint"
             required>
      <small id="usernameHint" class="form-text text-muted d-block mt-1">Unesi ime vašeg tima (2-20 znakova)</small>
    </div>

    <div class="mb-4">
      <label for="userpin" class="form-label text-white fw-bold mb-2">
        <i class="bi bi-shield-lock-fill me-2 text-warning" aria-hidden="true"></i>
        PIN
      </label>
      <input type="tel" id="userpin" class="form-control form-control-lg text-center fs-4"
             placeholder="0000"
             maxlength="4"
             inputmode="numeric"
             pattern="\d{4}"
             autocomplete="one-time-code"
             aria-describedby="pinHint"
             required>
      <small id="pinHint" class="form-text text-muted d-block mt-1">Unesi 4-znamenkasti PIN koji je dodijelio admin</small>
    </div>

    <button id="join-btn" class="btn btn-danger btn-lg w-100 fw-bold mb-3"
            onclick="joinGame()"
            aria-label="Ulazi u igru s unesenim korisničkim podacima">
      <span id="join-btn-text">
        <i class="bi bi-box-arrow-in-right me-2" aria-hidden="true"></i>
        ULAZ
      </span>
      <span id="join-btn-loading" class="d-none">
        <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
        Povezivanje...
      </span>
    </button>

    <div id="login-error" class="alert alert-danger d-none" role="alert" aria-live="polite" aria-atomic="true">
      <i class="bi bi-exclamation-triangle-fill me-2" aria-hidden="true"></i>
      <span id="error-message"></span>
    </div>

    <div class="text-center mt-4">
      <a href="{{ url_for('public.index') }}" class="btn btn-outline-secondary btn-sm">
        <i class="bi bi-arrow-left me-1" aria-hidden="true"></i>
        Nazad
      </a>
    </div>
  </div>

  <!-- GAME SCREEN -->
  <div id="game-screen" class="d-none fade-in">
    <div class="d-flex justify-content-between align-items-center text-white border-bottom pb-3 mb-4">
      <div>
        <small class="text-muted d-block">Tim:</small>
        <span id="player-name-display" class="fw-bold text-uppercase fs-5"></span>
      </div>
      <div class="text-center flex-grow-1">
        <small class="text-muted d-block">Točke:</small>
        <span class="badge bg-warning text-dark fs-4" id="my-score">0</span>
      </div>
      <div class="text-end">
        <button class="btn btn-sm btn-outline-danger" onclick="logout()"
                title="Odjava i povratak na login ekran"
                aria-label="Odjava">
          <i class="bi bi-box-arrow-right me-1" aria-hidden="true"></i>
          Odjava
        </button>
      </div>
    </div>

    <div id="answer-sheet">
      <div class="text-center text-muted mt-5 mb-5">
        <div class="spinner-border text-danger mb-3" role="status">
          <span class="visually-hidden">Čekanje...</span>
        </div>
        <p>Čekam početak runde...</p>
      </div>
    </div>

    <!-- GRADED ANSWER DISPLAY -->
    <div id="graded-answer-display" class="d-none mt-4">
      <div class="card bg-dark border-warning mb-4">
        <div class="card-header bg-warning text-dark fw-bold text-center py-2">
          <i class="bi bi-check-circle-fill me-2" aria-hidden="true"></i>
          REZULTAT PITANJA
        </div>
        <div class="card-body text-white p-4">
          <div class="row mb-4">
            <div class="col-6 text-center border-end border-secondary">
              <small class="text-muted d-block mb-2">TVOJ ODGOVOR</small>
              <div id="player-answer" class="fw-bold fs-5"></div>
            </div>
            <div class="col-6 text-center">
              <small class="text-muted d-block mb-2">TOČAN ODGOVOR</small>
              <div id="correct-answer" class="fw-bold fs-5 text-success"></div>
            </div>
          </div>
          <div class="text-center border-top border-secondary pt-3">
            <small class="text-muted d-block mb-2">OSVOJENI BODOVI</small>
            <div class="display-4 fw-bold">
              <span id="points-earned" class="text-warning">0</span>
              <span id="points-total" class="fs-6 text-muted">/2</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- LOCK OVERLAY -->
  <div id="lock-overlay" class="d-none">
    <div class="lock-badge">
      <i class="bi bi-lock-fill text-danger me-2" aria-hidden="true"></i>
      <span>ZAKLJUČANO</span>
    </div>
  </div>

  <!-- ANTI-CHEAT WARNING OVERLAY -->
  <div id="cheat-warning-overlay" class="d-none">
    <div class="cheat-warning-badge animate-pulse">
      <i class="bi bi-exclamation-triangle-fill text-danger me-2 fs-1" aria-hidden="true"></i>
      <div class="mt-3">
        <div class="fw-bold fs-4 text-danger">UPOZORENJE!</div>
        <div class="mt-2 text-white">Odgovori su zaključani</div>
        <div class="text-warning small mt-2" id="cheat-reason">Vraćanje u prozor...</div>
      </div>
    </div>
  </div>
</div>

<style>
#lock-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.9);
  z-index: 9999;
  display: flex;
  align-items: center;
  justify-content: center;
}

.lock-badge {
  background: rgba(211, 47, 47, 0.1);
  border: 3px solid #dc3545;
  border-radius: 20px;
  padding: 30px 50px;
  color: #dc3545;
  font-size: 1.5rem;
  font-weight: bold;
  text-transform: uppercase;
  letter-spacing: 2px;
}

#cheat-warning-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.95);
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
}

.cheat-warning-badge {
  background: rgba(211, 47, 47, 0.2);
  border: 4px solid #dc3545;
  border-radius: 20px;
  padding: 40px 60px;
  text-align: center;
  max-width: 400px;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.7; }
}

.animate-pulse {
  animation: pulse 2s ease-in-out infinite;
}

.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0,0,0,0);
  white-space: nowrap;
  border-width: 0;
}
</style>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/player.js') }}"></script>
{% endblock %}